{% extends "writing_list.html" %}
{% load show_tags i18n static %}
{% block title %}
    {% trans "Characters" %} - {{ event.name }}
{% endblock title %}
{% block info %}
    {% trans "This page shows the characters of the event" %}
{% endblock info %}
{% block nav_fields %}
    {% if user_character_max %}
        <a href="#" class="table_toggle" tog='player'>{% trans "Player" %}</a>
    {% endif %}
    {% if features.campaign and event.parent %}
        <a href="#" class="table_toggle" tog='attended'>{% trans "Attended" %}</a>
    {% endif %}
    {% if features.campaign %}
        <a href="#" class="table_toggle" tog='active'>{% trans "Active" %}</a>
    {% endif %}
    {% if user_character_approval %}
        <a href="#" class="table_toggle" tog='status'>{% trans "Status" %}</a>
    {% endif %}
    {% if features.px %}
        <a href="#" class="table_toggle" tog='px'>{% trans "XP" %}</a>
    {% endif %}
    {% include "elements/writing/questions_nav.html" %}
    {% if features.plot %}
        <a href="#" class="table_toggle" tog='plots'>{% trans "Plots" %}</a>
    {% endif %}
    {% if features.prologue %}
        <a href="#" class="table_toggle" tog='prologues'>{% trans "Prologues" %}</a>
    {% endif %}
    {% if features.relationships %}
        <a href="#" class="table_toggle" tog='relationship_list'>{% trans "Relationships" %}</a>
    {% endif %}
    {% if features.speedlarp %}
        <a href="#" class="table_toggle" tog='speedlarp'>{% trans "Speedlarp" %}</a>
    {% endif %}
{% endblock nav_fields %}
{% block thead %}
    <th></th>
    <th>{{ fields_name.name }}</th>
    <th></th>
    {% if user_character_max %}
        <th class="player">{% trans "Player" %}</th>
    {% endif %}
    {% if features.campaign and event.parent %}
        <th class="attended">{% trans "Attended" %}</th>
    {% endif %}
    {% if features.campaign %}
        <th class="active">{% trans "Active" %}</th>
    {% endif %}
    {% if user_character_approval %}
        <th class="status">{% trans "Status" %}</th>
    {% endif %}
    {% if features.px %}
        <th class="px">{% trans "XP tot" %}</th>
        <th class="px">{% trans "XP used" %}</th>
        <th class="px">{% trans "XP avail" %}</th>
    {% endif %}
    {% include "elements/writing/questions_header.html" %}
    {% if features.plot %}
        <th class="plots">{% trans "Plots" %}</th>
        <th class="stats">
            <i class="fa fa-hashtag"></i> {% trans "Plots" %}
        </th>
        {% if writing_unimportant %}
            <th class="stats">
                <i class="fa fa-hashtag"></i> {% trans "Important" %}
            </th>
        {% endif %}
    {% endif %}
    {% if features.prologue %}
        <th class="prologues">{% trans "Prologues" %}</th>
        <th class="stats">
            <i class="fa fa-hashtag"></i> {% trans "Prologues" %}
        </th>
    {% endif %}
    {% if features.relationships %}
        <th class="relationship_list">{% trans "Relationships" %}</th>
        <th class="stats">
            <i class="fa fa-hashtag"></i> {% trans "Relationships" %}
        </th>
        {% if writing_unimportant %}
            <th class="stats">
                <i class="fa fa-hashtag"></i> {% trans "Important" %}
            </th>
        {% endif %}
    {% endif %}
    {% if features.speedlarp %}
        <th class="speedlarp">{% trans "Speedlarp" %}</th>
        <th class="stats">
            <i class="fa fa-hashtag"></i> {% trans "Speedlarp" %}
        </th>
    {% endif %}
    <th class="only_new_form"></th>
{% endblock thead %}
{% block tbody %}
    {% for el in list %}
        <tr id="{{ el.uuid }}">
            <td>
                <a href="{% url 'orga_characters_edit' run.get_slug el.uuid %}"
                   qtip="{% trans "Edit" %}"><i class="fas fa-edit"></i></a>
            </td>
            <td class="editable" question_uuid="{{ name_que_uuid }}">{{ el }}</td>
            <td>
                <a href="{% url 'orga_characters_view' run.get_slug el.uuid %}"
                   qtip="{% trans "Read" %}"><i class="fa-solid fa-book-open"></i></a>
                <a href="{% url 'orga_characters_versions' run.get_slug el.uuid %}"
                   qtip="{% trans "Versions" %}"><i class="fas fa-file-alt"></i></a>
                <a href="{% url 'character' run.get_slug el.uuid %}"
                   qtip="{% trans "Gallery" %}"><i class="fa-solid fa-eye"></i></a>
                {% if writing_external_access %}
                    <a href="{% url 'character_external' run.get_slug el.access_token %}"
                       qtip="{% trans "External access" %}"><i class="fa-solid fa-key"></i></a>
                {% endif %}
                {% if features.print_pdf %}
                    <a href="{% url 'orga_characters_friendly_pdf' run.get_slug el.uuid %}"
                       download
                       qtip="PDF"><i class="fa-solid fa-file-pdf"></i></a>
                {% endif %}
            </td>
            {% if user_character_max %}<td class="player">{{ el.player.show_nick }}</td>{% endif %}
            {% if features.campaign and event.parent %}
                <td class="attended">
                    {% if el.has_registration %}<i class="fa fa-check"></i>{% endif %}
                </td>
            {% endif %}
            {% if features.campaign %}
                <td class="active">
                    {% if el.addit.inactive != "True" %}<i class="fa fa-check"></i>{% endif %}
                </td>
            {% endif %}
            {% if user_character_approval %}<td class="status">{{ el.get_status_display }}</td>{% endif %}
            {% if features.px %}
                <td class="px">{{ el.addit | get:'px_tot' }}</td>
                <td class="px">{{ el.addit | get:'px_used' }}</td>
                <td class="px">{{ el.addit | get:'px_avail' }}</td>
            {% endif %}
            {% include "elements/writing/questions_body.html" %}
            {% if features.plot %}
                <td class="plots dot_links">
                    {% for p in el.plot_rels.list %}
                        {% include "elements/comma.html" %}
                        <a href="{% url 'orga_plots_edit' run.get_slug p.0 %}">{{ p.1 }}</a>
                    {% endfor %}
                </td>
                <td class="stats">{{ el.plot_rels.count }}</td>
                {% if writing_unimportant %}<td class="stats">{{ el.plot_rels.important }}</td>{% endif %}
            {% endif %}
            {% if features.prologue %}
                <td class="prologues dot_links">
                    {% for p in el.prologue_rels.list %}
                        {% include "elements/comma.html" %}
                        <a href="{% url 'orga_prologues_edit' run.get_slug p.0 %}">{{ p.1 }}</a>
                    {% endfor %}
                </td>
                <td class="stats">{{ el.prologue_rels.count }}</td>
            {% endif %}
            {% if features.relationships %}
                <td class="relationship_list dot_links">
                    {% for rel in el.relationships_rels.list %}
                        {% include "elements/comma.html" %}
                        <a href="{% url 'orga_characters_edit' run.get_slug rel.0 %}">{{ rel.1 }}</a>
                    {% endfor %}
                </td>
                <td class="stats">{{ el.relationships_rels.count }}</td>
                {% if writing_unimportant %}<td class="stats">{{ el.relationships_rels.important }}</td>{% endif %}
            {% endif %}
            {% if features.speedlarp %}
                <td class="speedlarp dot_links">
                    {% for p in el.speedlarp_rels.list %}
                        {% include "elements/comma.html" %}
                        <a href="{% url 'orga_speedlarps_edit' run.get_slug p.0 %}">{{ p.1 }}</a>
                    {% endfor %}
                </td>
                <td class="stats">{{ el.speedlarp_rels.count }}</td>
            {% endif %}
            <td>
                <a href="{% url 'orga_characters_delete' run.get_slug el.uuid %}"
                   qtip="{% trans "Delete" %}"><i class="fas fa-trash"></i></a>
            </td>
        </tr>
    {% endfor %}
{% endblock tbody %}
{% block additional %}
    {% if form_questions %}
        <br />
        <p id="show">
            <b>{% trans "Load list" %}</b>
        </p>
        <div class="fields">
            {% for key, que in form_questions.items %}
                {% if que.typ == 's' or que.typ == 'm' %}
                    <a href="#" class="load_email_que" key="{{ key }}">{{ que.name | truncatechars:25 }}</a>
                    <a href="#" class="my_toggle hide" tog='email_que_{{ key }}'>hidden</a>
                {% endif %}
            {% endfor %}
        </div>
        {% for key, que in form_questions.items %}
            {% if que.typ == 's' or que.typ == 'm' %}
                <div class="email_que_{{ key }} hide">
                    <br />
                    <h4>{{ que.name }}</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Option</th>
                                <th>Count</th>
                                <th>Emails</th>
                                <th>Names</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Filled dynamically by jQuery -->
                        </tbody>
                    </table>
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}
{% endblock additional %}
