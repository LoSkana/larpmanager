{% load i18n static %}
{% trans "Welcome! Your organization has been created. Explore the platform to get started." as welcome_intro %}
{% trans "Start here to create your first event and begin using the platform." as welcome_cta %}
{% trans "Your first event has been created! Here is how to navigate the management interface." as first_event_intro %}
{% trans "Select the active workspace here: switch between your organization and your events." as select_workspace %}
{% trans "Switch here between administrative views and user-facing pages." as select_side %}
{% trans "This is the management dashboard, the interface will now be explained section by section." as intro %}
{% trans "This is the sidebar, it contains all management functions and remains visible across all admin pages." as sidebar %}
{% trans "Create, access, and manage your events from here." as exe_events %}
{% trans "Toggle the visibility of the sidebar." as sidebar_open %}
{% trans "Search here for settings, features, and configuration options." as wwyltd %}
{% trans "This section lists critical issues that require immediate attention." as priorities %}
{% trans "This is the task list of required actions to complete the event setup." as actions %}
{% trans "This list contains recommended actions to improve and finalize the configuration." as suggestions %}
{% trans "Open the tutorial to follow guided, step-by-step instructions for this feature." as feature_tutorial %}
{% trans "Write to us if you need help in setting things up!" as outro %}
<script src="{% static 'node_modules/driver.js/dist/driver.js.iife.js' %}"
        defer></script>
<script>
window.addEventListener('DOMContentLoaded', function() {

    function driverWelcome() {
        const driver = window.driver.js.driver;

        let steps = [
          {
            popover: {
              title: '{% filter escapejs %}{% trans "Welcome to" %} {{ association.platform }}{% endfilter %}!',
              description: '{{ welcome_intro | escapejs }}'
            }
          }
        ];

        if ($('#exe_events').is(':visible')) {
          steps.push({
            element: '#exe_events',
            popover: {
              title: '{% filter escapejs %}{% trans "Events" %}{% endfilter %}',
              description: '{{ welcome_cta | escapejs }}',
              side: 'right',
              align: 'start'
            }
          });
        }

        steps.push({
          popover: {
            title: '{% filter escapejs %}{% trans "And that is all" %}{% endfilter %}',
            description: '{{ outro | escapejs }}'
          }
        });

        const driverObj = driver({
            showProgress: true,
            steps: steps,
            allowClose: true,
            popoverClass: 'my-driverjs',
            doneBtnText: '{% filter escapejs %}{% trans "Done" %}{% endfilter %}',
        });

        driverObj.drive();
    }

    function driverFirstEvent() {
        const driver = window.driver.js.driver;

        let steps = [
          {
            popover: {
              title: '{% filter escapejs %}{% trans "Welcome to" %} {{ association.platform }}{% endfilter %}!',
              description: '{{ first_event_intro | escapejs }}'
            }
          },
          {
            element: '#select_workspace',
            popover: {
              title: '{% filter escapejs %}{% trans "Workspace selector" %}{% endfilter %}',
              description: '{{ select_workspace | escapejs }}',
              side: 'bottom',
              align: 'start'
            }
          },
          {
            element: '#select_side',
            popover: {
              title: '{% filter escapejs %}{% trans "Side selector" %}{% endfilter %}',
              description: '{{ select_side | escapejs }}',
              side: 'bottom',
              align: 'start'
            }
          }
        ];

        steps.push({
          popover: {
            title: '{% filter escapejs %}{% trans "And that is all" %}{% endfilter %}',
            description: '{{ outro | escapejs }}'
          }
        });

        const driverObj = driver({
            showProgress: true,
            steps: steps,
            allowClose: true,
            popoverClass: 'my-driverjs',
            doneBtnText: '{% filter escapejs %}{% trans "Done" %}{% endfilter %}',
        });

        driverObj.drive();
    }

    function driverIntro() {
        const driver = window.driver.js.driver;

        let steps = [
          {
            popover: {
              title: '{% filter escapejs %}{% trans "Welcome to" %} {{ association.platform }}{% endfilter %}!',
              description: '{{ intro | escapejs }}'
            }
          }
        ];

        if ($('.sidebar_button').is(':visible')) {
          steps.push({
            element: '#sidebar',
            popover: {
              title: 'Sidebar',
              description: '{{ sidebar | escapejs }}',
              side: 'right',
              align: 'start'
            }
          });
        }

        {% if not run %}
        if ($('#exe_events').is(':visible')) {
        steps.push({
          element: '#exe_events',
          popover: {
            title: 'Events',
            description: '{{ exe_events | escapejs }}',
            side: 'right',
            align: 'start'
          }
        });
        }
        {% endif %}

        const sidebar_id = $('.sidebar_tutorial:visible').first().attr('id');
        if (sidebar_id) {
          steps.push({
            element: '#' + sidebar_id,
            popover: {
              title: 'Sidebar toggle',
              description: '{{ sidebar_open | escapejs }}',
              side: 'bottom',
              align: 'start'
            }
          });
        }

        steps.push(
          {
            element: '#select_side',
            popover: {
              title: 'Side selector',
              description: '{{ select_side | escapejs }}',
              side: 'bottom',
              align: 'start'
            }
          },
          {
            element: '#select_workspace',
            popover: {
              title: 'Workspace selector',
              description: '{{ select_workspace | escapejs }}',
              side: 'bottom',
              align: 'start'
            }
          }
        );



        if ($('#wwyltd').is(':visible')) {
          steps.push({
            element: '#wwyltd',
            popover: {
              title: 'What would you like to do?',
              description: '{{ wwyltd | escapejs }}',
              side: 'bottom',
              align: 'start'
            }
          });
        }

        if ($('#priorities').is(':visible')) {
          steps.push({
            element: '#priorities',
            popover: {
              title: 'Priorities',
              description: '{{ priorities | escapejs }}',
              side: 'top',
              align: 'start'
            }
          });
        }

        if ($('#actions').is(':visible')) {
          steps.push({
            element: '#actions',
            popover: {
              title: 'Actions',
              description: '{{ actions | escapejs }}',
              side: 'top',
              align: 'start'
            }
          });
        }

        if ($('#suggestions').is(':visible')) {
          steps.push({
            element: '#suggestions',
            popover: {
              title: 'Suggestions',
              description: '{{ suggestions | escapejs }}',
              side: 'top',
              align: 'start'
            }
          });
        }

        if ($('.feature_tutorial').is(':visible')) {
          steps.push({
            element: '.feature_tutorial',
            popover: {
              title: 'Tutorials',
              description: '{{ feature_tutorial | escapejs }}',
              side: 'top',
              align: 'start'
            }
          });
        }

        steps.push({
          popover: {
            title: '{% filter escapejs %}{% trans "And that is all" %}{% endfilter %}',
            description: '{{ outro | escapejs }}'
          }
        });


        const driverObj = driver({
            showProgress: true,
            steps: steps,
            allowClose: true,
            popoverClass: 'my-driverjs',
            doneBtnText: '{% filter escapejs %}{% trans "Done" %}{% endfilter %}',
        });

        driverObj.drive();

    }

    jQuery(function(){
        {% if intro_driver == "welcome" %}
        $(document).on("lm_ready", function() {
            driverWelcome();
        });
        {% elif intro_driver == "first_event" %}
        $(document).on("lm_ready", function() {
            driverFirstEvent();
        });
        {% elif intro_driver == "advanced_unlock" %}
        $(document).on("lm_ready", function() {
            driverIntro();
        });
        {% endif %}

        $('#intro_driver').on('click', driverIntro);
    });

});

</script>
